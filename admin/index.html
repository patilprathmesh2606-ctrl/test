<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - DigitalMenuPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar {
            transition: all 0.3s ease;
        }
        
        .sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar.collapsed .sidebar-text {
            display: none;
        }
        
        .sidebar.collapsed .logo-text {
            display: none;
        }
        
        .main-content {
            transition: all 0.3s ease;
        }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .restaurant-row:hover {
            background-color: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-suspended {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .hidden {
            display: none !important;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px dashed #d1d5db;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="flex min-h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-gradient-to-b from-gray-900 to-gray-800 text-white w-64 flex flex-col">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-shield-alt text-xl"></i>
                    </div>
                    <div class="ml-3 logo-text">
                        <h1 class="text-xl font-bold" id="dashboardTitle">Admin Panel</h1>
                        <p class="text-xs text-gray-400" id="dashboardSubtitle">DigitalMenuPro</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 p-4">
                <ul class="space-y-2" id="sidebarNav">
                    <li>
                        <a href="#" onclick="showView('dashboard')" class="flex items-center p-3 rounded-lg hover:bg-gray-700 active-nav">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span class="ml-3 sidebar-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('restaurants')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-utensils w-6"></i>
                            <span class="ml-3 sidebar-text">Restaurants</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('subscriptions')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-credit-card w-6"></i>
                            <span class="ml-3 sidebar-text">Subscriptions</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('payments')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-rupee-sign w-6"></i>
                            <span class="ml-3 sidebar-text">Payments</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showView('users')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-users w-6"></i>
                            <span class="ml-3 sidebar-text" id="usersMenuText">All Users</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('staff_permissions')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-user-shield w-6"></i>
                            <span class="ml-3 sidebar-text">Staff Permissions</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('plans')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-cubes w-6"></i>
                            <span class="ml-3 sidebar-text">Plan Management</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('settings')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-cog w-6"></i>
                            <span class="ml-3 sidebar-text">System Settings</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" onclick="showView('terms')" class="flex items-center p-3 rounded-lg hover:bg-gray-700">
                            <i class="fas fa-file-contract w-6"></i>
                            <span class="ml-3 sidebar-text">Terms & Policies</span>
                        </a>
                    </li>
                </ul>
                
                <!-- User Profile -->
                <div class="mt-8 p-4 border-t border-gray-700">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="ml-3 sidebar-text">
                            <p class="font-medium" id="adminName">Loading...</p>
                            <p class="text-xs text-gray-400" id="adminEmail">Loading...</p>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Toggle Sidebar -->
            <div class="p-4 border-t border-gray-700">
                <button onclick="toggleSidebar()" class="flex items-center justify-center w-full p-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-chevron-left"></i>
                    <span class="ml-3 sidebar-text">Collapse Sidebar</span>
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div id="mainContent" class="main-content flex-1">
            <!-- Top Bar -->
            <header class="bg-white shadow-sm border-b px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800" id="viewTitle">Admin Dashboard</h2>
                        <p class="text-sm text-gray-600" id="viewSubtitle">System Overview & Analytics</p>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Notifications -->
                        <div class="relative">
                            <button onclick="toggleNotifications()" class="p-2 rounded-full hover:bg-gray-100 relative">
                                <i class="fas fa-bell text-gray-600"></i>
                                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                            </button>
                            <div id="notificationsPanel" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl z-50 border">
                                <div class="p-4 border-b">
                                    <h3 class="font-bold">Notifications</h3>
                                </div>
                                <div class="max-h-96 overflow-y-auto">
                                    <div id="notificationsList" class="p-4 space-y-3">
                                        <!-- Notifications will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search -->
                        <div class="relative">
                            <input type="text" id="globalSearch" placeholder="Search..." 
                                   class="pl-10 pr-4 py-2 border rounded-lg w-64 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <!-- Logout -->
                        <button onclick="adminLogout()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Content Area -->
            <main class="p-6">
                <!-- Dashboard View -->
                <div id="viewDashboard" class="view space-y-6">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-600 text-sm" id="stat1Title">Total Restaurants</p>
                                    <p class="text-3xl font-bold" id="totalRestaurants">0</p>
                                </div>
                                <i class="fas fa-utensils text-4xl text-blue-500"></i>
                            </div>
                            <div class="mt-4">
                                <div class="flex text-sm">
                                    <span class="text-green-600"><i class="fas fa-arrow-up mr-1"></i> 12%</span>
                                    <span class="text-gray-500 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-600 text-sm" id="stat2Title">Active Subscriptions</p>
                                    <p class="text-3xl font-bold" id="activeSubscriptions">0</p>
                                </div>
                                <i class="fas fa-credit-card text-4xl text-green-500"></i>
                            </div>
                            <div class="mt-4">
                                <div class="flex text-sm">
                                    <span class="text-green-600"><i class="fas fa-arrow-up mr-1"></i> 8%</span>
                                    <span class="text-gray-500 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-600 text-sm" id="stat3Title">Monthly Revenue</p>
                                    <p class="text-3xl font-bold" id="monthlyRevenue">₹0</p>
                                </div>
                                <i class="fas fa-rupee-sign text-4xl text-purple-500"></i>
                            </div>
                            <div class="mt-4">
                                <div class="flex text-sm">
                                    <span class="text-green-600"><i class="fas fa-arrow-up mr-1"></i> 15%</span>
                                    <span class="text-gray-500 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-600 text-sm" id="stat4Title">Pending Payments</p>
                                    <p class="text-3xl font-bold" id="pendingPayments">0</p>
                                </div>
                                <i class="fas fa-clock text-4xl text-yellow-500"></i>
                            </div>
                            <div class="mt-4">
                                <div class="flex text-sm">
                                    <span class="text-red-600"><i class="fas fa-arrow-down mr-1"></i> 3%</span>
                                    <span class="text-gray-500 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Staff Actions Section (Visible only to staff) -->
                    <div id="staffActionsSection" class="hidden">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">Quick Actions</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                                <button onclick="showAddDishModal()" class="staff-action p-3 bg-green-100 text-green-800 rounded-lg hover:bg-green-200" data-permission="addDish">
                                    <i class="fas fa-plus mb-1"></i>
                                    <span class="text-xs">Add Dish</span>
                                </button>
                                
                                <button onclick="showEditDishModal()" class="staff-action p-3 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200" data-permission="editDish">
                                    <i class="fas fa-edit mb-1"></i>
                                    <span class="text-xs">Edit Dish</span>
                                </button>
                                
                                <button onclick="showDeleteDishModal()" class="staff-action p-3 bg-red-100 text-red-800 rounded-lg hover:bg-red-200" data-permission="deleteDish">
                                    <i class="fas fa-trash mb-1"></i>
                                    <span class="text-xs">Delete Dish</span>
                                </button>
                                
                                <button onclick="showRevenueReport()" class="staff-action p-3 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200" data-permission="viewRevenue">
                                    <i class="fas fa-rupee-sign mb-1"></i>
                                    <span class="text-xs">View Revenue</span>
                                </button>
                                
                                <button onclick="showReserveTableModal()" class="staff-action p-3 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200" data-permission="reserveTable">
                                    <i class="fas fa-chair mb-1"></i>
                                    <span class="text-xs">Reserve Table</span>
                                </button>
                                
                                <button onclick="showOrdersModal()" class="staff-action p-3 bg-indigo-100 text-indigo-800 rounded-lg hover:bg-indigo-200" data-permission="viewTableOrders">
                                    <i class="fas fa-list-alt mb-1"></i>
                                    <span class="text-xs">View Orders</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Order History Section -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                            <h3 class="text-lg font-bold mb-4">Order History</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="staff-action" data-permission="viewOrderHistoryName">
                                    <h4 class="font-medium mb-2">By Customer Name</h4>
                                    <div id="orderHistoryByName" class="bg-gray-50 p-4 rounded-lg max-h-60 overflow-y-auto">
                                        <p class="text-sm text-gray-600">Loading...</p>
                                    </div>
                                </div>
                                
                                <div class="staff-action" data-permission="viewOrderHistoryTable">
                                    <h4 class="font-medium mb-2">By Table Number</h4>
                                    <div id="orderHistoryByTable" class="bg-gray-50 p-4 rounded-lg max-h-60 overflow-y-auto">
                                        <p class="text-sm text-gray-600">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">Revenue Trend</h3>
                            <div class="h-80">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">Plan Distribution</h3>
                            <div class="h-80">
                                <canvas id="planChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activities -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold">Recent Activities</h3>
                            <button onclick="loadActivities()" class="text-sm text-blue-600 hover:text-blue-800">
                                <i class="fas fa-sync-alt mr-1"></i> Refresh
                            </button>
                        </div>
                        <div id="activitiesList" class="space-y-4">
                            <!-- Activities will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Restaurants View -->
                <div id="viewRestaurants" class="view hidden">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold" id="restaurantsViewTitle">Restaurant Management</h2>
                            <p class="text-gray-600" id="restaurantsViewSubtitle">Manage all registered restaurants</p>
                        </div>
                        <div class="flex space-x-3">
                            <input type="text" id="restaurantSearch" placeholder="Search restaurants..." 
                                   class="px-4 py-2 border rounded-lg w-64" oninput="filterRestaurants()">
                            <button onclick="exportRestaurants()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 admin-only">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                            <button onclick="showAddDishModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 staff-only hidden">
                                <i class="fas fa-plus mr-2"></i>Add Dish
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="bg-white rounded-lg shadow p-4 mb-6 admin-only">
                        <div class="flex flex-wrap gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="statusFilter" onchange="filterRestaurants()" class="px-3 py-2 border rounded-lg">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Plan</label>
                                <select id="planFilter" onchange="filterRestaurants()" class="px-3 py-2 border rounded-lg">
                                    <option value="">All Plans</option>
                                    <option value="basic">Basic</option>
                                    <option value="pro">Pro</option>
                                    <option value="enterprise">Enterprise</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                                <input type="date" id="dateFrom" onchange="filterRestaurants()" class="px-3 py-2 border rounded-lg">
                                <span class="mx-2">to</span>
                                <input type="date" id="dateTo" onchange="filterRestaurants()" class="px-3 py-2 border rounded-lg">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Restaurants/Menu Table -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr id="restaurantsTableHeader">
                                        <!-- Table headers will be set dynamically -->
                                    </tr>
                                </thead>
                                <tbody id="restaurantsTable" class="bg-white divide-y divide-gray-200">
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center">
                            <div class="text-sm text-gray-500">
                                Showing <span id="restaurantStart">0</span> to <span id="restaurantEnd">0</span> of <span id="restaurantTotal">0</span> <span id="restaurantLabel">restaurants</span>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="prevRestaurantPage()" class="px-3 py-1 border rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button onclick="nextRestaurantPage()" class="px-3 py-1 border rounded-lg hover:bg-gray-50">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- All Users View -->
                <div id="viewUsers" class="view hidden">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold" id="usersViewTitle">User Management</h2>
                            <p class="text-gray-600" id="usersViewSubtitle">Manage all system users across restaurants</p>
                        </div>
                        <div class="flex space-x-3">
                            <input type="text" id="userSearch" placeholder="Search users..." 
                                   class="px-4 py-2 border rounded-lg w-64" oninput="filterUsers()">
                            <button onclick="exportUsers()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 admin-only">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Restaurant</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Active</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable" class="bg-white divide-y divide-gray-200">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Other views (Subscriptions, Payments, Plans, Settings, Terms) -->
                <!-- These remain mostly the same as your old dashboard -->
                
            </main>
        </div>
    </div>
    
    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal-overlay fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-blue-600 to-purple-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-shield-alt text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800">Admin Login</h3>
                <p class="text-gray-600 mt-2">DigitalMenuPro Control Panel</p>
            </div>
            
            <div class="space-y-4">
                <input type="email" id="adminEmailInput" placeholder="Admin Email" 
                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <input type="password" id="adminPassword" placeholder="Password" 
                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <button onclick="handleAdminLogin()" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-purple-700">
                    Login as Admin
                </button>
                
                <p class="text-sm text-gray-500 text-center mt-4">
                    <i class="fas fa-info-circle mr-1"></i>
                    Admin access requires special privileges
                </p>
            </div>
        </div>
    </div>

    <!-- MODALS FOR QUICK ACTIONS -->

    <!-- Add Dish Modal -->
    <div id="addDishModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Add New Dish</h3>
                    <button onclick="closeAddDishModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="addDishForm" onsubmit="event.preventDefault(); saveNewDish();">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Dish Name *</label>
                            <input type="text" id="dishName" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="dishDescription" rows="3" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                                <select id="dishCategory" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select Category</option>
                                    <option value="Starters">Starters</option>
                                    <option value="Main Course">Main Course</option>
                                    <option value="Desserts">Desserts</option>
                                    <option value="Beverages">Beverages</option>
                                    <option value="Specials">Specials</option>
                                    <option value="Appetizers">Appetizers</option>
                                    <option value="Soups">Soups</option>
                                    <option value="Salads">Salads</option>
                                    <option value="Breads">Breads</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹) *</label>
                                <input type="number" id="dishPrice" min="0" step="0.01" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Preparation Time (minutes)</label>
                                <input type="number" id="dishPrepTime" min="0" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Availability</label>
                                <select id="dishAvailability" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="true">Available</option>
                                    <option value="false">Not Available</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tags (comma separated)</label>
                            <input type="text" id="dishTags" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="e.g., spicy, vegan, gluten-free">
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Dish Image</label>
                            <div class="space-y-4">
                                <!-- Option 1: Upload from computer -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Upload Image</label>
                                    <input type="file" id="dishImageFile" accept="image/*" 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           onchange="previewImage(this, 'addDishImagePreview')">
                                    <div class="mt-2">
                                        <img id="addDishImagePreview" class="image-preview hidden" src="" alt="Image preview">
                                    </div>
                                </div>
                                
                                <!-- Option 2: Use URL -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Or enter Image URL</label>
                                    <input type="url" id="dishImageUrl" 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           placeholder="https://example.com/dish-image.jpg">
                                </div>
                                
                                <!-- Option 3: Select from preloaded images -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Or select from preloaded images</label>
                                    <select id="preloadedImageSelect" onchange="selectPreloadedImage()" 
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select an image</option>
                                        <option value="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400&h=300&fit=crop">Burger</option>
                                        <option value="https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=300&fit=crop">Salad</option>
                                        <option value="https://images.unsplash.com/photo-1563379926898-05f4575a45d8?w-400&h=300&fit=crop">Pizza</option>
                                        <option value="https://images.unsplash.com/photo-1565299585323-38d6b0865b47?w=400&h=300&fit=crop">Pasta</option>
                                        <option value="https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=300&fit=crop">Dessert</option>
                                        <option value="https://images.unsplash.com/photo-1513104890138-7c749659a591?w=400&h=300&fit=crop">Pizza 2</option>
                                        <option value="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400&h=300&fit=crop">Burger 2</option>
                                        <option value="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400&h=300&fit=crop">Healthy Food</option>
                                        <option value="https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?w=400&h=300&fit=crop">Breakfast</option>
                                        <option value="https://images.unsplash.com/photo-1565299507177-b0ac66763828?w=400&h=300&fit=crop">Dish</option>
                                    </select>
                                    <div class="mt-2">
                                        <img id="preloadedImagePreview" class="image-preview hidden" src="" alt="Selected image">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="imageUploadStatus" class="hidden text-sm"></div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button type="button" onclick="closeAddDishModal()" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" id="saveDishBtn" 
                                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center">
                                <span>Save Dish</span>
                                <div id="saveDishLoading" class="loading ml-2 hidden"></div>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Dish Modal -->
    <div id="editDishModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Edit Dish</h3>
                    <button onclick="closeEditDishModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="editDishForm" onsubmit="event.preventDefault(); updateDish();">
                    <input type="hidden" id="editDishId">
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Dish Name *</label>
                            <input type="text" id="editDishName" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="editDishDescription" rows="3" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                                <select id="editDishCategory" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select Category</option>
                                    <option value="Starters">Starters</option>
                                    <option value="Main Course">Main Course</option>
                                    <option value="Desserts">Desserts</option>
                                    <option value="Beverages">Beverages</option>
                                    <option value="Specials">Specials</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹) *</label>
                                <input type="number" id="editDishPrice" min="0" step="0.01" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Preparation Time (minutes)</label>
                                <input type="number" id="editDishPrepTime" min="0" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Availability</label>
                                <select id="editDishAvailability" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="true">Available</option>
                                    <option value="false">Not Available</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tags (comma separated)</label>
                            <input type="text" id="editDishTags" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <!-- Image Upload Section for Edit -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Dish Image</label>
                            <div class="space-y-4">
                                <!-- Current Image Preview -->
                                <div id="currentImageContainer" class="hidden">
                                    <p class="text-sm text-gray-600 mb-2">Current Image:</p>
                                    <img id="currentDishImage" class="image-preview" src="" alt="Current dish image">
                                </div>
                                
                                <!-- Option 1: Upload from computer -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Upload New Image</label>
                                    <input type="file" id="editDishImageFile" accept="image/*" 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           onchange="previewImage(this, 'editDishImagePreview')">
                                    <div class="mt-2">
                                        <img id="editDishImagePreview" class="image-preview hidden" src="" alt="Image preview">
                                    </div>
                                </div>
                                
                                <!-- Option 2: Use URL -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Or enter New Image URL</label>
                                    <input type="url" id="editDishImageUrl" 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                
                                <!-- Option 3: Select from preloaded images -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Or select from preloaded images</label>
                                    <select id="editPreloadedImageSelect" onchange="selectEditPreloadedImage()" 
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select an image</option>
                                        <option value="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400&h=300&fit=crop">Burger</option>
                                        <option value="https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=300&fit=crop">Salad</option>
                                        <option value="https://images.unsplash.com/photo-1563379926898-05f4575a45d8?w-400&h=300&fit=crop">Pizza</option>
                                        <option value="https://images.unsplash.com/photo-1565299585323-38d6b0865b47?w=400&h=300&fit=crop">Pasta</option>
                                        <option value="https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=300&fit=crop">Dessert</option>
                                    </select>
                                    <div class="mt-2">
                                        <img id="editPreloadedImagePreview" class="image-preview hidden" src="" alt="Selected image">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="editImageUploadStatus" class="hidden text-sm"></div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button type="button" onclick="closeEditDishModal()" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" id="updateDishBtn" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center">
                                <span>Update Dish</span>
                                <div id="updateDishLoading" class="loading ml-2 hidden"></div>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Dish Confirmation Modal -->
    <div id="deleteDishModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl w-full max-w-md">
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Delete Dish</h3>
                    <p class="text-gray-600" id="deleteDishMessage">Are you sure you want to delete this dish?</p>
                </div>
                
                <input type="hidden" id="deleteDishId">
                
                <div class="flex justify-center space-x-3">
                    <button onclick="closeDeleteDishModal()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Cancel
                    </button>
                    <button onclick="confirmDeleteDish()" 
                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Report Modal -->
    <div id="revenueReportModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Revenue Report</h3>
                    <button onclick="closeRevenueReportModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Date Range Selector -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                            <select id="revenueDateRange" onchange="updateRevenueReport()" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="today">Today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="week">Last 7 Days</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        
                        <div id="customDateRange" class="hidden md:flex items-center space-x-2">
                            <input type="date" id="revenueStartDate" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg">
                            <span>to</span>
                            <input type="date" id="revenueEndDate" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg">
                            <button onclick="applyCustomDateRange()" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Apply
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Revenue Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white border rounded-lg p-4 shadow">
                        <div class="text-sm text-gray-600 mb-1">Total Revenue</div>
                        <div class="text-2xl font-bold text-gray-800" id="totalRevenue">₹0</div>
                    </div>
                    <div class="bg-white border rounded-lg p-4 shadow">
                        <div class="text-sm text-gray-600 mb-1">Total Orders</div>
                        <div class="text-2xl font-bold text-gray-800" id="totalOrders">0</div>
                    </div>
                    <div class="bg-white border rounded-lg p-4 shadow">
                        <div class="text-sm text-gray-600 mb-1">Average Order Value</div>
                        <div class="text-2xl font-bold text-gray-800" id="averageOrderValue">₹0</div>
                    </div>
                </div>
                
                <!-- Revenue Chart -->
                <div class="bg-white border rounded-lg p-4 shadow mb-6">
                    <h4 class="font-medium text-gray-800 mb-4">Revenue Trend</h4>
                    <div class="h-64">
                        <canvas id="revenueReportChart"></canvas>
                    </div>
                </div>
                
                <!-- Top Selling Dishes -->
                <div class="bg-white border rounded-lg p-4 shadow">
                    <h4 class="font-medium text-gray-800 mb-4">Top Selling Dishes</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-2 text-left">Dish Name</th>
                                    <th class="px-4 py-2 text-left">Quantity Sold</th>
                                    <th class="px-4 py-2 text-left">Revenue</th>
                                </tr>
                            </thead>
                            <tbody id="topDishesTable">
                                <!-- Will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Table Reservation Modal -->
    <div id="reserveTableModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Reserve Table</h3>
                    <button onclick="closeReserveTableModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="reserveTableForm" onsubmit="event.preventDefault(); reserveTable();">
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Customer Name *</label>
                                <input type="text" id="customerName" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
                                <input type="tel" id="customerPhone" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Number of Guests *</label>
                                <select id="numberOfGuests" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select</option>
                                    <option value="1">1 Person</option>
                                    <option value="2">2 People</option>
                                    <option value="3">3 People</option>
                                    <option value="4">4 People</option>
                                    <option value="5">5 People</option>
                                    <option value="6">6 People</option>
                                    <option value="7">7 People</option>
                                    <option value="8">8 People</option>
                                    <option value="9">9+ People</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Table Number</label>
                                <select id="tableNumber" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Auto Assign</option>
                                    <option value="1">Table 1</option>
                                    <option value="2">Table 2</option>
                                    <option value="3">Table 3</option>
                                    <option value="4">Table 4</option>
                                    <option value="5">Table 5</option>
                                    <option value="6">Table 6</option>
                                    <option value="7">Table 7</option>
                                    <option value="8">Table 8</option>
                                    <option value="9">Table 9</option>
                                    <option value="10">Table 10</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Reservation Date *</label>
                                <input type="date" id="reservationDate" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Reservation Time *</label>
                                <input type="time" id="reservationTime" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Special Requests</label>
                            <textarea id="specialRequests" rows="3" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button type="button" onclick="closeReserveTableModal()" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" 
                                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                Reserve Table
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Orders Modal -->
    <div id="ordersModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Current Orders</h3>
                    <button onclick="closeOrdersModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Filters -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <select id="orderStatusFilter" onchange="filterOrders()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="all">All Orders</option>
                        <option value="pending">Pending</option>
                        <option value="preparing">Preparing</option>
                        <option value="ready">Ready</option>
                        <option value="served">Served</option>
                        <option value="completed">Completed</option>
                    </select>
                    
                    <input type="text" id="orderSearch" placeholder="Search by table or customer..." 
                           class="px-4 py-2 border border-gray-300 rounded-lg w-64" oninput="filterOrders()">
                </div>
                
                <!-- Orders Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="ordersGrid">
                    <!-- Orders will be loaded dynamically -->
                </div>
                
                <!-- No Orders Message -->
                <div id="noOrdersMessage" class="text-center py-12 hidden">
                    <i class="fas fa-clipboard-list text-4xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">No orders found</p>
                </div>
            </div>
        </div>
    </div>

<script>
// Configuration
const SUPABASE_URL = 'https://aazqyrkklajqscsdfgjl.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhenF5cmtrbGFqcXNjc2RmZ2psIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NTg4MjUsImV4cCI6MjA4NDMzNDgyNX0.MCmhASRpt_N1gkK7BiVBzp4NT98aCWOWetgtUCoj7Go';

// Initialize Supabase
let supabaseClient;
try {
    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('✓ Supabase initialized successfully');
} catch (error) {
    console.error('Supabase initialization error:', error);
}

// Global variables
let currentUser = null;
let currentRestaurant = null;
let userRole = 'admin'; // 'admin' or 'staff'
let isStaffMode = false;
let restaurants = [];
let subscriptions = [];
let payments = [];
let users = [];
let dishes = [];
let currentRestaurantPage = 1;
let currentPaymentPage = 1;
const itemsPerPage = 10;

// Chart instances
let revenueChart = null;
let planChart = null;
let revenueReportChart = null;

// Current orders data
let currentOrders = [];

// Image upload handling
let uploadedImageUrl = null;

// Initialize dashboard
async function initDashboard() {
    try {
        // Set today's date for date inputs
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('reservationDate').value = today;
        
        // Check if user is already logged in
        const { data: { user } } = await supabaseClient.auth.getUser();
        
        if (user) {
            const urlParams = new URLSearchParams(window.location.search);
            const restaurantSlug = urlParams.get('restaurant');
            const staffParam = urlParams.get('staff');
            
            if (restaurantSlug && staffParam === 'true') {
                isStaffMode = true;
                await handleStaffAccess(user, restaurantSlug);
            } else {
                await handleAdminAccess(user);
            }
        } else {
            document.getElementById('adminLoginModal').classList.remove('hidden');
        }
    } catch (error) {
        console.error('❌ Dashboard initialization error:', error);
        document.getElementById('adminLoginModal').classList.remove('hidden');
    }
}

// Image preview function
function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    const file = input.files[0];
    
    if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.remove('hidden');
        }
        
        reader.readAsDataURL(file);
    } else {
        preview.src = '';
        preview.classList.add('hidden');
    }
}

// Select preloaded image for add dish
function selectPreloadedImage() {
    const select = document.getElementById('preloadedImageSelect');
    const preview = document.getElementById('preloadedImagePreview');
    const urlInput = document.getElementById('dishImageUrl');
    
    if (select.value) {
        preview.src = select.value;
        preview.classList.remove('hidden');
        urlInput.value = select.value;
        uploadedImageUrl = select.value;
    } else {
        preview.src = '';
        preview.classList.add('hidden');
        urlInput.value = '';
        uploadedImageUrl = null;
    }
}

// Select preloaded image for edit dish
function selectEditPreloadedImage() {
    const select = document.getElementById('editPreloadedImageSelect');
    const preview = document.getElementById('editPreloadedImagePreview');
    const urlInput = document.getElementById('editDishImageUrl');
    
    if (select.value) {
        preview.src = select.value;
        preview.classList.remove('hidden');
        urlInput.value = select.value;
        uploadedImageUrl = select.value;
    } else {
        preview.src = '';
        preview.classList.add('hidden');
        urlInput.value = '';
        uploadedImageUrl = null;
    }
}

// Upload image to Supabase Storage
async function uploadImageToStorage(file, dishId) {
    try {
        console.log('Uploading image to storage...');
        
        // Create unique filename
        const fileExt = file.name.split('.').pop();
        const fileName = `${dishId || 'temp'}_${Date.now()}.${fileExt}`;
        const filePath = `dish-images/${fileName}`;
        
        // Upload to Supabase Storage
        const { data, error } = await supabaseClient.storage
            .from('dish-images')
            .upload(filePath, file, {
                cacheControl: '3600',
                upsert: true
            });
        
        if (error) {
            console.error('Error uploading image:', error);
            return null;
        }
        
        // Get public URL
        const { data: { publicUrl } } = supabaseClient.storage
            .from('dish-images')
            .getPublicUrl(filePath);
        
        console.log('Image uploaded successfully:', publicUrl);
        return publicUrl;
        
    } catch (error) {
        console.error('Error in uploadImageToStorage:', error);
        return null;
    }
}

// Handle staff access
async function handleStaffAccess(user, restaurantSlug) {
    try {
        console.log('🔍 Checking staff access for:', user.email, 'restaurant:', restaurantSlug);
        
        // Get restaurant by slug
        const { data: restaurant, error: resError } = await supabaseClient
            .from('restaurants')
            .select('*')
            .eq('url_slug', restaurantSlug)
            .single();
        
        if (resError || !restaurant) {
            console.error('Restaurant not found:', resError);
            alert('Restaurant not found. Redirecting...');
            window.location.href = `../menu-dynamic.html?slug=${restaurantSlug}`;
            return;
        }
        
        // Check if user is staff for this restaurant
        const { data: staffUser, error: staffError } = await supabaseClient
            .from('staff_users')
            .select('*')
            .eq('user_id', user.id)
            .eq('restaurant_id', restaurant.id)
            .eq('is_active', true)
            .single();
        
        if (staffError || !staffUser) {
            console.error('Staff not found or inactive:', staffError);
            alert('You are not authorized to access this restaurant dashboard.');
            window.location.href = `../menu-dynamic.html?slug=${restaurantSlug}`;
            return;
        }
        
        currentUser = staffUser;
        currentRestaurant = restaurant;
        userRole = staffUser.role;
        
        console.log('✅ Staff logged in:', staffUser.name, 'Role:', staffUser.role, 'Restaurant:', restaurant.name);
        
        // Set default permissions if none exist
        if (!staffUser.permissions || Object.keys(staffUser.permissions).length === 0) {
            console.log('⚠️ No permissions found, setting defaults...');
            await setDefaultPermissions(staffUser.id, staffUser.role);
            const { data: updatedUser } = await supabaseClient
                .from('staff_users')
                .select('*')
                .eq('id', staffUser.id)
                .single();
            currentUser = updatedUser;
        }
        
        console.log('📋 User permissions:', currentUser.permissions);
        
        setupStaffUI();
        await loadRestaurantData(restaurant.id);
        document.getElementById('adminLoginModal').classList.add('hidden');
        document.getElementById('adminDashboard').classList.remove('hidden');
        
        console.log('✓ Staff dashboard initialized');
        
    } catch (error) {
        console.error('❌ Staff access error:', error);
        document.getElementById('adminLoginModal').classList.remove('hidden');
    }
}

// Function to set default permissions
async function setDefaultPermissions(userId, role) {
    const defaultPermissions = {
        'owner': {
            "addDish": true,
            "editDish": true,
            "deleteDish": true,
            "manageStaff": true,
            "viewRevenue": true,
            "reserveTable": true,
            "viewTableOrders": true,
            "viewOrderHistoryName": true,
            "viewOrderHistoryTable": true
        },
        'manager': {
            "addDish": true,
            "editDish": true,
            "deleteDish": true,
            "manageStaff": false,
            "viewRevenue": true,
            "reserveTable": true,
            "viewTableOrders": true,
            "viewOrderHistoryName": true,
            "viewOrderHistoryTable": true
        },
        'chef': {
            "addDish": true,
            "editDish": true,
            "deleteDish": true,
            "manageStaff": false,
            "viewRevenue": false,
            "reserveTable": false,
            "viewTableOrders": true,
            "viewOrderHistoryName": true,
            "viewOrderHistoryTable": true
        },
        'waiter': {
            "addDish": false,
            "editDish": false,
            "deleteDish": false,
            "manageStaff": false,
            "viewRevenue": false,
            "reserveTable": true,
            "viewTableOrders": true,
            "viewOrderHistoryName": true,
            "viewOrderHistoryTable": true
        }
    };
    
    const permissions = defaultPermissions[role] || defaultPermissions.waiter;
    
    const { error } = await supabaseClient
        .from('staff_users')
        .update({ 
            permissions: permissions,
            updated_at: new Date().toISOString()
        })
        .eq('id', userId);
    
    if (error) {
        console.error('Error setting default permissions:', error);
        throw error;
    }
    
    console.log('✓ Default permissions set for', role);
}

// Get current user's permissions
function getUserPermissions() {
    if (userRole === 'admin') {
        return {
            "addDish": true,
            "editDish": true,
            "deleteDish": true,
            "manageStaff": true,
            "viewRevenue": true,
            "reserveTable": true,
            "viewTableOrders": true,
            "viewOrderHistoryName": true,
            "viewOrderHistoryTable": true
        };
    }
    return currentUser?.permissions || {};
}

// Check if user has specific permission
function hasPermission(permissionName) {
    const permissions = getUserPermissions();
    return permissions[permissionName] === true;
}

// Update UI based on permissions
function updateUIBasedOnPermissions() {
    if (userRole === 'admin') return;
    
    const permissions = getUserPermissions();
    console.log('🔧 Applying user permissions:', permissions);
    
    const staffActionsSection = document.getElementById('staffActionsSection');
    if (staffActionsSection) {
        staffActionsSection.classList.remove('hidden');
    }
    
    document.querySelectorAll('[data-permission]').forEach(element => {
        const permissionName = element.getAttribute('data-permission');
        const hasPerm = hasPermission(permissionName);
        
        if (hasPerm) {
            element.classList.remove('hidden');
        } else {
            element.classList.add('hidden');
        }
        
        if (element.tagName === 'BUTTON') {
            element.disabled = !hasPerm;
        }
    });
    
    if (userRole === 'owner') {
        document.querySelectorAll('.staff-action').forEach(el => {
            el.classList.remove('hidden');
            if (el.tagName === 'BUTTON') {
                el.disabled = false;
            }
        });
    }
}

// QUICK ACTIONS MODAL FUNCTIONS

// Add Dish
function showAddDishModal() {
    if (!hasPermission('addDish')) {
        alert('You do not have permission to add dishes');
        return;
    }
    
    // Reset form
    document.getElementById('addDishForm').reset();
    
    // Clear image previews
    document.getElementById('addDishImagePreview').classList.add('hidden');
    document.getElementById('preloadedImagePreview').classList.add('hidden');
    
    // Reset uploaded image URL
    uploadedImageUrl = null;
    
    // Show modal
    document.getElementById('addDishModal').classList.remove('hidden');
    console.log('Add Dish modal opened');
}

function closeAddDishModal() {
    document.getElementById('addDishModal').classList.add('hidden');
    uploadedImageUrl = null;
}

async function saveNewDish() {
    if (!hasPermission('addDish')) {
        alert('Permission denied');
        return;
    }
    
    // Get form values
    const dishName = document.getElementById('dishName').value;
    const dishPrice = document.getElementById('dishPrice').value;
    const dishCategory = document.getElementById('dishCategory').value;
    
    // Validate required fields
    if (!dishName || !dishPrice || !dishCategory) {
        alert('Please fill in all required fields (Name, Price, Category)');
        return;
    }
    
    // Show loading state
    const saveBtn = document.getElementById('saveDishBtn');
    const loading = document.getElementById('saveDishLoading');
    saveBtn.disabled = true;
    loading.classList.remove('hidden');
    
    try {
        let finalImageUrl = null;
        
        // Check for uploaded file
        const fileInput = document.getElementById('dishImageFile');
        const urlInput = document.getElementById('dishImageUrl').value;
        
        if (fileInput.files && fileInput.files[0]) {
            // Upload file to storage
            console.log('Uploading image file...');
            const file = fileInput.files[0];
            
            // Create temporary dish ID for file naming
            const tempDishId = Date.now().toString();
            finalImageUrl = await uploadImageToStorage(file, tempDishId);
            
            if (!finalImageUrl) {
                throw new Error('Failed to upload image');
            }
        } else if (urlInput) {
            // Use URL if provided
            finalImageUrl = urlInput;
        } else if (uploadedImageUrl) {
            // Use preloaded image if selected
            finalImageUrl = uploadedImageUrl;
        }
        
        // Prepare dish data
        const dishData = {
            restaurant_id: currentRestaurant.id,
            name: dishName,
            description: document.getElementById('dishDescription').value,
            category: dishCategory,
            price: parseFloat(dishPrice),
            preparation_time: parseInt(document.getElementById('dishPrepTime').value) || null,
            is_available: document.getElementById('dishAvailability').value === 'true',
            tags: document.getElementById('dishTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
            image_url: finalImageUrl,
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        
        console.log('Saving dish:', dishData);
        
        // Save to database
        const { data, error } = await supabaseClient
            .from('dishes')
            .insert([dishData])
            .select();
        
        if (error) {
            console.error('Database error:', error);
            throw error;
        }
        
        // Refresh dishes list
        await loadRestaurantData(currentRestaurant.id);
        
        // Show success message
        alert('Dish added successfully!');
        closeAddDishModal();
        
        // Update UI
        if (!document.getElementById('viewRestaurants').classList.contains('hidden')) {
            loadRestaurantsTable();
        }
        
    } catch (error) {
        console.error('Error adding dish:', error);
        alert('Error adding dish: ' + (error.message || 'Unknown error'));
    } finally {
        // Reset loading state
        saveBtn.disabled = false;
        loading.classList.add('hidden');
    }
}

// Edit Dish
function showEditDishModal() {
    if (!hasPermission('editDish')) {
        alert('You do not have permission to edit dishes');
        return;
    }
    
    // For demo, show the first dish - in real app, you'd select which dish to edit
    if (dishes.length === 0) {
        alert('No dishes available to edit');
        return;
    }
    
    // Let user select a dish to edit (for now, edit first dish)
    const dish = dishes[0];
    
    // Fill form with dish data
    document.getElementById('editDishId').value = dish.id;
    document.getElementById('editDishName').value = dish.name;
    document.getElementById('editDishDescription').value = dish.description || '';
    document.getElementById('editDishCategory').value = dish.category;
    document.getElementById('editDishPrice').value = dish.price;
    document.getElementById('editDishPrepTime').value = dish.preparation_time || '';
    document.getElementById('editDishAvailability').value = dish.is_available ? 'true' : 'false';
    document.getElementById('editDishTags').value = dish.tags ? dish.tags.join(', ') : '';
    
    // Handle image
    const currentImage = document.getElementById('currentDishImage');
    const currentImageContainer = document.getElementById('currentImageContainer');
    if (dish.image_url) {
        currentImage.src = dish.image_url;
        currentImageContainer.classList.remove('hidden');
        document.getElementById('editDishImageUrl').value = dish.image_url;
    } else {
        currentImageContainer.classList.add('hidden');
    }
    
    // Clear other image previews
    document.getElementById('editDishImagePreview').classList.add('hidden');
    document.getElementById('editPreloadedImagePreview').classList.add('hidden');
    
    // Reset uploaded image URL
    uploadedImageUrl = null;
    
    // Show modal
    document.getElementById('editDishModal').classList.remove('hidden');
    console.log('Edit Dish modal opened for:', dish.name);
}

function closeEditDishModal() {
    document.getElementById('editDishModal').classList.add('hidden');
    uploadedImageUrl = null;
}

async function updateDish() {
    if (!hasPermission('editDish')) {
        alert('Permission denied');
        return;
    }
    
    const dishId = document.getElementById('editDishId').value;
    
    // Validate required fields
    if (!dishId || !document.getElementById('editDishName').value || 
        !document.getElementById('editDishPrice').value || 
        !document.getElementById('editDishCategory').value) {
        alert('Please fill in all required fields');
        return;
    }
    
    // Show loading state
    const updateBtn = document.getElementById('updateDishBtn');
    const loading = document.getElementById('updateDishLoading');
    updateBtn.disabled = true;
    loading.classList.remove('hidden');
    
    try {
        let finalImageUrl = document.getElementById('editDishImageUrl').value;
        
        // Check for uploaded file
        const fileInput = document.getElementById('editDishImageFile');
        
        if (fileInput.files && fileInput.files[0]) {
            // Upload file to storage
            console.log('Uploading new image file...');
            const file = fileInput.files[0];
            const newImageUrl = await uploadImageToStorage(file, dishId);
            
            if (newImageUrl) {
                finalImageUrl = newImageUrl;
            }
        } else if (uploadedImageUrl) {
            // Use preloaded image if selected
            finalImageUrl = uploadedImageUrl;
        }
        
        // Prepare dish data
        const dishData = {
            name: document.getElementById('editDishName').value,
            description: document.getElementById('editDishDescription').value,
            category: document.getElementById('editDishCategory').value,
            price: parseFloat(document.getElementById('editDishPrice').value),
            preparation_time: parseInt(document.getElementById('editDishPrepTime').value) || null,
            is_available: document.getElementById('editDishAvailability').value === 'true',
            tags: document.getElementById('editDishTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
            image_url: finalImageUrl || null,
            updated_at: new Date().toISOString()
        };
        
        console.log('Updating dish:', dishId, dishData);
        
        // Update in database
        const { data, error } = await supabaseClient
            .from('dishes')
            .update(dishData)
            .eq('id', dishId)
            .select();
        
        if (error) {
            console.error('Database error:', error);
            throw error;
        }
        
        // Refresh dishes list
        await loadRestaurantData(currentRestaurant.id);
        
        // Show success message
        alert('Dish updated successfully!');
        closeEditDishModal();
        
        // Update UI
        if (!document.getElementById('viewRestaurants').classList.contains('hidden')) {
            loadRestaurantsTable();
        }
        
    } catch (error) {
        console.error('Error updating dish:', error);
        alert('Error updating dish: ' + (error.message || 'Unknown error'));
    } finally {
        // Reset loading state
        updateBtn.disabled = false;
        loading.classList.add('hidden');
    }
}

// Delete Dish
function showDeleteDishModal() {
    if (!hasPermission('deleteDish')) {
        alert('You do not have permission to delete dishes');
        return;
    }
    
    // For demo, show confirmation for first dish
    if (dishes.length === 0) {
        alert('No dishes available to delete');
        return;
    }
    
    const dish = dishes[0];
    document.getElementById('deleteDishId').value = dish.id;
    document.getElementById('deleteDishMessage').textContent = `Are you sure you want to delete "${dish.name}"? This action cannot be undone.`;
    
    // Show modal
    document.getElementById('deleteDishModal').classList.remove('hidden');
}

function closeDeleteDishModal() {
    document.getElementById('deleteDishModal').classList.add('hidden');
}

async function confirmDeleteDish() {
    if (!hasPermission('deleteDish')) {
        alert('Permission denied');
        return;
    }
    
    const dishId = document.getElementById('deleteDishId').value;
    
    try {
        const { data, error } = await supabaseClient
            .from('dishes')
            .delete()
            .eq('id', dishId);
        
        if (error) throw error;
        
        // Refresh dishes list
        await loadRestaurantData(currentRestaurant.id);
        
        // Show success message
        alert('Dish deleted successfully!');
        closeDeleteDishModal();
        
        // Update UI
        if (!document.getElementById('viewRestaurants').classList.contains('hidden')) {
            loadRestaurantsTable();
        }
        
    } catch (error) {
        console.error('Error deleting dish:', error);
        alert('Error deleting dish: ' + error.message);
    }
}

// View Revenue
function showRevenueReport() {
    if (!hasPermission('viewRevenue')) {
        alert('You do not have permission to view revenue');
        return;
    }
    
    loadRevenueReport();
    document.getElementById('revenueReportModal').classList.remove('hidden');
}

function closeRevenueReportModal() {
    document.getElementById('revenueReportModal').classList.add('hidden');
}

async function loadRevenueReport() {
    try {
        // For demo, we'll use sample data
        // In a real app, you would fetch from Supabase
        
        const today = new Date();
        const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
        
        // Sample data for demo
        const sampleData = {
            totalRevenue: 12500,
            totalOrders: 42,
            averageOrderValue: 297.62,
            topDishes: [
                { name: "Butter Chicken", quantity: 18, revenue: 3600 },
                { name: "Garlic Naan", quantity: 35, revenue: 2800 },
                { name: "Biryani", quantity: 12, revenue: 2400 },
                { name: "Paneer Tikka", quantity: 15, revenue: 2250 },
                { name: "Mango Lassi", quantity: 20, revenue: 1600 }
            ],
            hourlyRevenue: [800, 1200, 1800, 2200, 2500, 3000]
        };
        
        // Update UI
        document.getElementById('totalRevenue').textContent = `₹${sampleData.totalRevenue}`;
        document.getElementById('totalOrders').textContent = sampleData.totalOrders;
        document.getElementById('averageOrderValue').textContent = `₹${sampleData.averageOrderValue}`;
        
        // Update top dishes table
        let topDishesHTML = '';
        sampleData.topDishes.forEach((dish, index) => {
            topDishesHTML += `
                <tr class="${index % 2 === 0 ? 'bg-gray-50' : ''}">
                    <td class="px-4 py-2">${dish.name}</td>
                    <td class="px-4 py-2">${dish.quantity}</td>
                    <td class="px-4 py-2">₹${dish.revenue}</td>
                </tr>
            `;
        });
        document.getElementById('topDishesTable').innerHTML = topDishesHTML;
        
        // Update chart
        updateRevenueChart(sampleData.hourlyRevenue);
        
    } catch (error) {
        console.error('Error loading revenue report:', error);
    }
}

function updateRevenueChart(hourlyRevenue) {
    const ctx = document.getElementById('revenueReportChart').getContext('2d');
    
    if (revenueReportChart) {
        revenueReportChart.destroy();
    }
    
    const hours = ['10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM'];
    
    revenueReportChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: hours.slice(0, hourlyRevenue.length),
            datasets: [{
                label: 'Revenue (₹)',
                data: hourlyRevenue,
                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                borderColor: 'rgb(59, 130, 246)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        display: true
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
}

function updateRevenueReport() {
    const range = document.getElementById('revenueDateRange').value;
    
    if (range === 'custom') {
        document.getElementById('customDateRange').classList.remove('hidden');
    } else {
        document.getElementById('customDateRange').classList.add('hidden');
        loadRevenueReport();
    }
}

function applyCustomDateRange() {
    const startDate = document.getElementById('revenueStartDate').value;
    const endDate = document.getElementById('revenueEndDate').value;
    
    if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
    }
    
    // In a real app, you would fetch data for the selected date range
    console.log('Loading revenue for date range:', startDate, 'to', endDate);
    loadRevenueReport();
}

// Reserve Table
function showReserveTableModal() {
    if (!hasPermission('reserveTable')) {
        alert('You do not have permission to reserve tables');
        return;
    }
    
    // Reset form
    document.getElementById('reserveTableForm').reset();
    
    // Set default time (next hour)
    const now = new Date();
    now.setHours(now.getHours() + 1);
    const nextHour = now.toTimeString().substring(0, 5);
    document.getElementById('reservationTime').value = nextHour;
    
    // Show modal
    document.getElementById('reserveTableModal').classList.remove('hidden');
}

function closeReserveTableModal() {
    document.getElementById('reserveTableModal').classList.add('hidden');
}

async function reserveTable() {
    if (!hasPermission('reserveTable')) {
        alert('Permission denied');
        return;
    }
    
    const reservationData = {
        restaurant_id: currentRestaurant.id,
        customer_name: document.getElementById('customerName').value,
        customer_phone: document.getElementById('customerPhone').value,
        number_of_guests: parseInt(document.getElementById('numberOfGuests').value),
        table_number: document.getElementById('tableNumber').value || null,
        reservation_date: document.getElementById('reservationDate').value,
        reservation_time: document.getElementById('reservationTime').value,
        special_requests: document.getElementById('specialRequests').value,
        status: 'confirmed',
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
    };
    
    try {
        // In a real app, you would insert into a reservations table
        // For demo, we'll just show a success message
        
        console.log('Reservation data:', reservationData);
        
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Show success message
        alert(`Table reserved successfully!\n\nReservation Details:\nCustomer: ${reservationData.customer_name}\nDate: ${reservationData.reservation_date}\nTime: ${reservationData.reservation_time}\nGuests: ${reservationData.number_of_guests}`);
        
        closeReserveTableModal();
        
    } catch (error) {
        console.error('Error creating reservation:', error);
        alert('Error creating reservation: ' + error.message);
    }
}

// View Orders
function showOrdersModal() {
    if (!hasPermission('viewTableOrders')) {
        alert('You do not have permission to view orders');
        return;
    }
    
    loadCurrentOrders();
    document.getElementById('ordersModal').classList.remove('hidden');
}

function closeOrdersModal() {
    document.getElementById('ordersModal').classList.add('hidden');
}

async function loadCurrentOrders() {
    try {
        // In a real app, fetch orders from Supabase
        // For demo, use sample data
        
        const sampleOrders = [
            {
                id: 'ORD001',
                table_number: 'T1',
                customer_name: 'John Doe',
                status: 'preparing',
                total_amount: 1250,
                items: [
                    { name: 'Butter Chicken', quantity: 2, price: 250 },
                    { name: 'Garlic Naan', quantity: 4, price: 40 }
                ],
                created_at: new Date().toISOString()
            },
            {
                id: 'ORD002',
                table_number: 'T3',
                customer_name: 'Jane Smith',
                status: 'pending',
                total_amount: 850,
                items: [
                    { name: 'Paneer Tikka', quantity: 1, price: 200 },
                    { name: 'Biryani', quantity: 1, price: 300 },
                    { name: 'Coke', quantity: 2, price: 50 }
                ],
                created_at: new Date().toISOString()
            },
            {
                id: 'ORD003',
                table_number: 'T5',
                customer_name: 'Robert Johnson',
                status: 'ready',
                total_amount: 1800,
                items: [
                    { name: 'Butter Chicken', quantity: 1, price: 250 },
                    { name: 'Biryani', quantity: 2, price: 300 },
                    { name: 'Garlic Naan', quantity: 6, price: 40 }
                ],
                created_at: new Date().toISOString()
            }
        ];
        
        currentOrders = sampleOrders;
        renderOrders(sampleOrders);
        
    } catch (error) {
        console.error('Error loading orders:', error);
    }
}

function renderOrders(orders) {
    const ordersGrid = document.getElementById('ordersGrid');
    const noOrdersMessage = document.getElementById('noOrdersMessage');
    
    if (orders.length === 0) {
        ordersGrid.innerHTML = '';
        noOrdersMessage.classList.remove('hidden');
        return;
    }
    
    noOrdersMessage.classList.add('hidden');
    
    let ordersHTML = '';
    
    orders.forEach(order => {
        const statusColors = {
            'pending': 'bg-yellow-100 text-yellow-800',
            'preparing': 'bg-blue-100 text-blue-800',
            'ready': 'bg-green-100 text-green-800',
            'served': 'bg-purple-100 text-purple-800',
            'completed': 'bg-gray-100 text-gray-800'
        };
        
        const statusText = {
            'pending': 'Pending',
            'preparing': 'Preparing',
            'ready': 'Ready to Serve',
            'served': 'Served',
            'completed': 'Completed'
        };
        
        const statusColor = statusColors[order.status] || 'bg-gray-100 text-gray-800';
        const statusDisplay = statusText[order.status] || order.status;
        
        let itemsHTML = '';
        order.items.forEach(item => {
            itemsHTML += `
                <div class="flex justify-between text-sm">
                    <span>${item.name} × ${item.quantity}</span>
                    <span>₹${item.price * item.quantity}</span>
                </div>
            `;
        });
        
        ordersHTML += `
            <div class="border rounded-lg p-4 hover:shadow-lg transition-shadow">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="font-bold text-lg">Table ${order.table_number}</div>
                        <div class="text-sm text-gray-600">${order.customer_name}</div>
                    </div>
                    <span class="px-3 py-1 text-xs rounded-full ${statusColor}">
                        ${statusDisplay}
                    </span>
                </div>
                
                <div class="space-y-2 mb-4">
                    ${itemsHTML}
                </div>
                
                <div class="border-t pt-3">
                    <div class="flex justify-between font-bold">
                        <span>Total</span>
                        <span>₹${order.total_amount}</span>
                    </div>
                    
                    <div class="flex space-x-2 mt-3">
                        ${order.status === 'pending' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'preparing')" 
                                    class="flex-1 bg-blue-600 text-white py-1 rounded hover:bg-blue-700 text-sm">
                                Start Preparing
                            </button>
                        ` : ''}
                        
                        ${order.status === 'preparing' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'ready')" 
                                    class="flex-1 bg-green-600 text-white py-1 rounded hover:bg-green-700 text-sm">
                                Mark Ready
                            </button>
                        ` : ''}
                        
                        ${order.status === 'ready' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'served')" 
                                    class="flex-1 bg-purple-600 text-white py-1 rounded hover:bg-purple-700 text-sm">
                                Mark Served
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
    });
    
    ordersGrid.innerHTML = ordersHTML;
}

function filterOrders() {
    const statusFilter = document.getElementById('orderStatusFilter').value;
    const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
    
    let filteredOrders = currentOrders;
    
    if (statusFilter !== 'all') {
        filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
    }
    
    if (searchTerm) {
        filteredOrders = filteredOrders.filter(order => 
            order.table_number.toLowerCase().includes(searchTerm) ||
            order.customer_name.toLowerCase().includes(searchTerm)
        );
    }
    
    renderOrders(filteredOrders);
}

async function updateOrderStatus(orderId, newStatus) {
    try {
        // In a real app, update order in Supabase
        console.log(`Updating order ${orderId} to status: ${newStatus}`);
        
        // Update local state
        const orderIndex = currentOrders.findIndex(order => order.id === orderId);
        if (orderIndex !== -1) {
            currentOrders[orderIndex].status = newStatus;
            renderOrders(currentOrders);
            
            // Show success message
            const statusMessages = {
                'preparing': 'Order is now being prepared',
                'ready': 'Order is ready to serve',
                'served': 'Order has been served'
            };
            
            alert(statusMessages[newStatus] || 'Order status updated');
        }
        
    } catch (error) {
        console.error('Error updating order status:', error);
        alert('Error updating order status: ' + error.message);
    }
}

// Load Order History
async function loadOrderHistory() {
    if (!hasPermission('viewOrderHistoryName') && !hasPermission('viewOrderHistoryTable')) {
        return;
    }
    
    try {
        // In a real app, fetch order history from Supabase
        // For demo, use sample data
        
        const sampleHistoryByName = [
            { customer: 'John Doe', orders: 5, total: 6250 },
            { customer: 'Jane Smith', orders: 3, total: 2550 },
            { customer: 'Robert Johnson', orders: 7, total: 12600 },
            { customer: 'Sarah Williams', orders: 2, total: 1800 }
        ];
        
        const sampleHistoryByTable = [
            { table: 'T1', orders: 8, total: 10000 },
            { table: 'T3', orders: 5, total: 6250 },
            { table: 'T5', orders: 12, total: 15000 },
            { table: 'T7', orders: 3, total: 3750 }
        ];
        
        // Render history by name
        if (hasPermission('viewOrderHistoryName')) {
            let historyByNameHTML = '';
            sampleHistoryByName.forEach(item => {
                historyByNameHTML += `
                    <div class="flex justify-between items-center p-2 border-b">
                        <div>
                            <div class="font-medium">${item.customer}</div>
                            <div class="text-sm text-gray-600">${item.orders} orders</div>
                        </div>
                        <div class="font-bold">₹${item.total}</div>
                    </div>
                `;
            });
            document.getElementById('orderHistoryByName').innerHTML = historyByNameHTML || '<p class="text-gray-500">No history available</p>';
        }
        
        // Render history by table
        if (hasPermission('viewOrderHistoryTable')) {
            let historyByTableHTML = '';
            sampleHistoryByTable.forEach(item => {
                historyByTableHTML += `
                    <div class="flex justify-between items-center p-2 border-b">
                        <div>
                            <div class="font-medium">Table ${item.table}</div>
                            <div class="text-sm text-gray-600">${item.orders} orders</div>
                        </div>
                        <div class="font-bold">₹${item.total}</div>
                    </div>
                `;
            });
            document.getElementById('orderHistoryByTable').innerHTML = historyByTableHTML || '<p class="text-gray-500">No history available</p>';
        }
        
    } catch (error) {
        console.error('Error loading order history:', error);
    }
}

// Setup UI for staff
function setupStaffUI() {
    document.querySelectorAll('.admin-only').forEach(el => {
        el.style.display = 'none';
    });
    
    document.querySelectorAll('.staff-only').forEach(el => {
        el.style.display = 'block';
    });
    
    document.getElementById('dashboardTitle').textContent = currentRestaurant?.name || 'Staff Dashboard';
    document.getElementById('dashboardSubtitle').textContent = 'Staff Portal';
    
    document.getElementById('restaurantsViewTitle').textContent = 'Menu Management';
    document.getElementById('restaurantsViewSubtitle').textContent = 'Manage your restaurant menu';
    
    document.getElementById('usersViewTitle').textContent = 'Staff Management';
    document.getElementById('usersViewSubtitle').textContent = 'Manage restaurant staff members';
    
    document.getElementById('restaurantLabel').textContent = 'menu items';
    
    updateUIBasedOnPermissions();
}

// Handle admin access
async function handleAdminAccess(user) {
    try {
        const { data: adminUser, error: adminError } = await supabaseClient
            .from('staff_users')
            .select('*')
            .eq('email', user.email)
            .eq('role', 'admin')
            .single();
            
        if (adminError || !adminUser) {
            const { data: staffUser } = await supabaseClient
                .from('staff_users')
                .select('*, restaurants(*)')
                .eq('user_id', user.id)
                .eq('is_active', true)
                .single();
                
            if (staffUser) {
                window.location.href = `index.html?restaurant=${staffUser.restaurants.url_slug}&staff=true`;
                return;
            }
            
            alert('Access denied. Admin privileges required.');
            await supabaseClient.auth.signOut();
            document.getElementById('adminLoginModal').classList.remove('hidden');
            return;
        }
        
        currentUser = adminUser;
        userRole = 'admin';
        
        setupAdminUI();
        await loadAdminData();
        document.getElementById('adminLoginModal').classList.add('hidden');
        document.getElementById('adminDashboard').classList.remove('hidden');
        
        console.log('✓ Admin dashboard initialized');
        
    } catch (error) {
        console.error('❌ Admin access error:', error);
        document.getElementById('adminLoginModal').classList.remove('hidden');
    }
}

// Setup UI for admin
function setupAdminUI() {
    document.querySelectorAll('.admin-only').forEach(el => {
        el.style.display = 'block';
    });
    
    document.querySelectorAll('.staff-only').forEach(el => {
        el.style.display = 'none';
    });
    
    document.getElementById('staffActionsSection').style.display = 'none';
    document.getElementById('dashboardTitle').textContent = 'Admin Panel';
    document.getElementById('dashboardSubtitle').textContent = 'DigitalMenuPro';
}

// Show admin login modal
function showAdminLogin() {
    document.getElementById('adminLoginModal').classList.remove('hidden');
}

// Handle login
async function handleAdminLogin() {
    const email = document.getElementById('adminEmailInput').value;
    const password = document.getElementById('adminPassword').value;
    
    if (!email || !password) {
        alert('Please enter email and password');
        return;
    }
    
    try {
        const { data, error } = await supabaseClient.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (error) throw error;
        window.location.reload();
        
    } catch (error) {
        console.error('Admin login error:', error);
        alert('Login failed: ' + error.message);
    }
}

// Logout
async function adminLogout() {
    try {
        await supabaseClient.auth.signOut();
        currentUser = null;
        showAdminLogin();
    } catch (error) {
        console.error('Logout error:', error);
    }
}

// Load admin data
async function loadAdminData() {
    try {
        console.log('📊 Loading admin data...');
        
        // Load restaurants
        const { data: restaurantsData, error: resError } = await supabaseClient
            .from('restaurants')
            .select('*')
            .order('created_at', { ascending: false });
        
        if (!resError) restaurants = restaurantsData || [];
        
        // Load subscriptions
        const { data: subsData, error: subsError } = await supabaseClient
            .from('subscriptions')
            .select('*, restaurants(name)')
            .order('created_at', { ascending: false });
        
        if (!subsError) subscriptions = subsData || [];
        
        // Load payments
        const { data: paymentsData, error: payError } = await supabaseClient
            .from('payments')
            .select('*, restaurants(name)')
            .order('created_at', { ascending: false });
        
        if (!payError) payments = paymentsData || [];
        
        // Load all users
        const { data: usersData, error: usersError } = await supabaseClient
            .from('staff_users')
            .select('*, restaurants(name)')
            .order('created_at', { ascending: false });
        
        if (!usersError) users = usersData || [];
        
        updateDashboardStats();
        setupCharts();
        loadNotifications();
        loadActivities();
        
        console.log('✓ Admin data loaded');
        
    } catch (error) {
        console.error('❌ Error loading admin data:', error);
    }
}

// Load restaurant data for staff dashboard
async function loadRestaurantData(restaurantId) {
    try {
        console.log(`📋 Loading data for restaurant: ${restaurantId}`);
        
        // Load dishes for this restaurant
        const { data: dishesData, error: dishesError } = await supabaseClient
            .from('dishes')
            .select('*')
            .eq('restaurant_id', restaurantId)
            .order('category', { ascending: true });
        
        if (!dishesError) {
            dishes = dishesData || [];
            console.log(`✓ Loaded ${dishes.length} dishes`);
        } else {
            console.error('Error loading dishes:', dishesError);
            dishes = [];
        }
        
        // Load staff members for this restaurant
        const { data: staffData, error: staffError } = await supabaseClient
            .from('staff_users')
            .select('*')
            .eq('restaurant_id', restaurantId)
            .eq('is_active', true);
        
        if (!staffError) {
            users = staffData || [];
            console.log(`✓ Loaded ${users.length} active staff members`);
        }
        
        // Update UI with restaurant name
        document.getElementById('adminName').textContent = currentUser?.name || 'Staff User';
        document.getElementById('adminEmail').textContent = currentUser?.email || currentUser?.user_email || 'staff@example.com';
        
        setupStaffCharts();
        loadNotifications();
        loadActivities();
        
        // Load order history
        loadOrderHistory();
        
        console.log('✓ Restaurant data loaded successfully');
        
    } catch (error) {
        console.error('❌ Error loading restaurant data:', error);
        dishes = [];
        users = [];
    }
}

// Update dashboard stats
function updateDashboardStats() {
    // Total restaurants
    document.getElementById('totalRestaurants').textContent = restaurants.length;
    
    // Active subscriptions
    const activeSubs = subscriptions.filter(s => s.status === 'active').length;
    document.getElementById('activeSubscriptions').textContent = activeSubs;
    
    // Monthly revenue (last 30 days)
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    
    const monthlyRevenue = payments
        .filter(p => p.status === 'completed' && new Date(p.created_at) >= thirtyDaysAgo)
        .reduce((sum, p) => sum + (p.amount || 0), 0);
    document.getElementById('monthlyRevenue').textContent = `₹${monthlyRevenue}`;
    
    // Pending payments
    const pending = payments.filter(p => p.status === 'pending').length;
    document.getElementById('pendingPayments').textContent = pending;
    
    // Update title based on user
    if (userRole !== 'admin' && currentRestaurant) {
        document.getElementById('stat1Title').textContent = 'Menu Items';
        document.getElementById('totalRestaurants').textContent = dishes.length;
        
        document.getElementById('stat2Title').textContent = 'Today\'s Orders';
        document.getElementById('activeSubscriptions').textContent = '42'; // Sample data
        
        document.getElementById('stat3Title').textContent = 'Active Staff';
        document.getElementById('monthlyRevenue').textContent = users.length;
        
        document.getElementById('stat4Title').textContent = 'Table Occupancy';
        document.getElementById('pendingPayments').textContent = '75%'; // Sample data
    }
}

function setupCharts() {
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const last6Months = getLast6Months();
    
    if (revenueChart) revenueChart.destroy();
    
    revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: last6Months,
            datasets: [{
                label: 'Revenue (₹)',
                data: generateRevenueData(last6Months),
                borderColor: 'rgb(59, 130, 246)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        display: true
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
    
    // Plan Distribution Chart
    const planCtx = document.getElementById('planChart').getContext('2d');
    
    if (planChart) planChart.destroy();
    
    const planCounts = {
        basic: subscriptions.filter(s => s.plan === 'basic').length,
        pro: subscriptions.filter(s => s.plan === 'pro').length,
        enterprise: subscriptions.filter(s => s.plan === 'enterprise').length
    };
    
    planChart = new Chart(planCtx, {
        type: 'doughnut',
        data: {
            labels: ['Basic', 'Pro', 'Enterprise'],
            datasets: [{
                data: [planCounts.basic, planCounts.pro, planCounts.enterprise],
                backgroundColor: [
                    'rgb(34, 197, 94)',
                    'rgb(59, 130, 246)',
                    'rgb(139, 92, 246)'
                ],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

function setupStaffCharts() {
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    if (revenueChart) revenueChart.destroy();
    
    revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['8AM', '10AM', '12PM', '2PM', '4PM', '6PM', '8PM'],
            datasets: [{
                label: "Today's Orders",
                data: [5, 12, 8, 15, 10, 20, 18],
                borderColor: 'rgb(59, 130, 246)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            }
        }
    });
    
    const planCtx = document.getElementById('planChart').getContext('2d');
    if (planChart) planChart.destroy();
    
    const categoryCount = {};
    dishes.forEach(dish => {
        categoryCount[dish.category] = (categoryCount[dish.category] || 0) + 1;
    });
    
    planChart = new Chart(planCtx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(categoryCount),
            datasets: [{
                data: Object.values(categoryCount),
                backgroundColor: [
                    'rgb(59, 130, 246)',
                    'rgb(16, 185, 129)',
                    'rgb(245, 158, 11)',
                    'rgb(239, 68, 68)',
                    'rgb(139, 92, 246)',
                    'rgb(236, 72, 153)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                }
            }
        }
    });
}

function getLast6Months() {
    const months = [];
    const now = new Date();
    
    for (let i = 5; i >= 0; i--) {
        const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
        months.push(date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' }));
    }
    
    return months;
}

function generateRevenueData(months) {
    return months.map(() => Math.floor(Math.random() * 50000) + 10000);
}

async function loadNotifications() {
    try {
        let html = '';
        
        if (userRole === 'admin') {
            const pendingPayments = payments.filter(p => p.status === 'pending').length;
            const pendingRestaurants = restaurants.filter(r => r.status === 'pending').length;
            
            if (pendingPayments > 0) {
                html += `
                    <div class="flex items-start p-3 bg-yellow-50 rounded-lg">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mt-1 mr-3"></i>
                        <div>
                            <p class="font-medium">${pendingPayments} pending payment${pendingPayments > 1 ? 's' : ''}</p>
                            <p class="text-sm text-gray-600">Require verification</p>
                        </div>
                    </div>
                `;
            }
            
            if (pendingRestaurants > 0) {
                html += `
                    <div class="flex items-start p-3 bg-blue-50 rounded-lg">
                        <i class="fas fa-clock text-blue-600 mt-1 mr-3"></i>
                        <div>
                            <p class="font-medium">${pendingRestaurants} restaurant${pendingRestaurants > 1 ? 's' : ''} pending</p>
                            <p class="text-sm text-gray-600">Awaiting activation</p>
                        </div>
                    </div>
                `;
            }
        } else {
            // Sample staff notifications
            const today = new Date();
            const reservationsToday = 8; // Sample data
            
            html = `
                <div class="flex items-start p-3 bg-blue-50 rounded-lg">
                    <i class="fas fa-chair text-blue-600 mt-1 mr-3"></i>
                    <div>
                        <p class="font-medium">${reservationsToday} reservations today</p>
                        <p class="text-sm text-gray-600">Check table availability</p>
                    </div>
                </div>
                
                <div class="flex items-start p-3 bg-green-50 rounded-lg">
                    <i class="fas fa-utensils text-green-600 mt-1 mr-3"></i>
                    <div>
                        <p class="font-medium">2 new orders</p>
                        <p class="text-sm text-gray-600">Waiting for preparation</p>
                    </div>
                </div>
            `;
        }
        
        if (!html) {
            html = '<p class="text-gray-500 text-center py-4">No notifications</p>';
        }
        
        document.getElementById('notificationsList').innerHTML = html;
        
    } catch (error) {
        console.error('Error loading notifications:', error);
    }
}

async function loadActivities() {
    try {
        let html = '';
        
        if (userRole === 'admin') {
            const recentPayments = payments.slice(0, 5);
            recentPayments.forEach(payment => {
                const date = new Date(payment.created_at).toLocaleDateString();
                const time = new Date(payment.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                html += `
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full ${payment.status === 'completed' ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} flex items-center justify-center mr-3">
                            <i class="fas fa-rupee-sign text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium">${payment.restaurants?.name || 'Unknown Restaurant'}</p>
                            <p class="text-sm text-gray-600">Payment of ₹${payment.amount} ${payment.status}</p>
                            <p class="text-xs text-gray-500">${date} at ${time}</p>
                        </div>
                    </div>
                `;
            });
            
            const recentRestaurants = restaurants.slice(0, 3);
            recentRestaurants.forEach(restaurant => {
                const date = new Date(restaurant.created_at).toLocaleDateString();
                
                html += `
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-3">
                            <i class="fas fa-utensils text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium">${restaurant.name}</p>
                            <p class="text-sm text-gray-600">New restaurant registered</p>
                            <p class="text-xs text-gray-500">${date}</p>
                        </div>
                    </div>
                `;
            });
        } else {
            // Sample staff activities
            const activities = [
                { icon: 'fa-plus', color: 'green', title: 'New dish added', desc: 'Butter Chicken added to menu', time: '10:30 AM' },
                { icon: 'fa-edit', color: 'blue', title: 'Dish updated', desc: 'Paneer Tikka price updated', time: '11:45 AM' },
                { icon: 'fa-chair', color: 'purple', title: 'Table reserved', desc: 'Table 3 reserved for 4 people', time: '12:15 PM' },
                { icon: 'fa-list-alt', color: 'orange', title: 'Order completed', desc: 'Order #ORD003 served', time: '1:30 PM' }
            ];
            
            activities.forEach(activity => {
                html += `
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-${activity.color}-100 text-${activity.color}-600 flex items-center justify-center mr-3">
                            <i class="fas ${activity.icon} text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium">${activity.title}</p>
                            <p class="text-sm text-gray-600">${activity.desc}</p>
                            <p class="text-xs text-gray-500">${activity.time}</p>
                        </div>
                    </div>
                `;
            });
        }
        
        document.getElementById('activitiesList').innerHTML = html || '<p class="text-gray-500 text-center py-4">No recent activities</p>';
        
    } catch (error) {
        console.error('Error loading activities:', error);
    }
}

// Initialize the dashboard
initDashboard();
</script>
</body>
</html>
